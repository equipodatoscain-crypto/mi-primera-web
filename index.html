<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Recepción de Certificados</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #eef1f7;
        margin: 0;
        padding: 0;
    }

    h1 {
        text-align: center;
        color: white;
        background: #3155ff;
        padding: 18px;
        margin: 0 0 20px 0;
        border-radius: 0 0 10px 10px;
        font-size: 26px;
    }

    .container {
        max-width: 95%;
        margin: 20px auto;
        background: #fff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    }

    label {
        font-size: 18px;
        font-weight: bold;
        display: block;
        margin-top: 10px;
    }

    input, select {
        width: 100%;
        padding: 12px;
        font-size: 18px;
        margin-top: 5px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

    /* FILAS DE FECHAS Y CAMPOS */
    .row {
        display: grid;
        grid-template-columns: 110px 180px 180px 1fr;
        gap: 15px;
        align-items: start;
        margin-bottom: 18px;
    }

    .placa {
        font-size: 18px;
        text-transform: uppercase;
    }

    .obs {
        width: 100%;
        font-size: 18px;
    }

    /* MENSAJE DE ERROR */
    .error {
        color: red;
        font-size: 14px;
        text-align: center;
        margin-top: 4px;
    }

    /* BOTÓN */
    .btn {
        margin-top: 15px;
        padding: 12px;
        background: #3155ff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        width: 100%;
    }

    .btn:hover {
        background: #1e3fe0;
    }
</style>

</head>
<body>

<h1>Recepción de Certificados</h1>

<div class="container">

    <label>Año:</label>
    <select id="year">
        <option value="">Seleccione año</option>
        <option>2025</option>
        <option>2026</option>
        <option>2027</option>
    </select>
    <div id="errYear" class="error"></div>

    <label>Mes:</label>
    <select id="month">
        <option value="">Seleccione mes</option>
        <option>Enero</option><option>Febrero</option><option>Marzo</option>
        <option>Abril</option><option>Mayo</option><option>Junio</option>
        <option>Julio</option><option>Agosto</option><option>Septiembre</option>
        <option>Octubre</option><option>Noviembre</option><option>Diciembre</option>
    </select>
    <div id="errMonth" class="error"></div>

    <label>Número de Ruta:</label>
    <input id="ruta" placeholder="Ejemplo: U-001" style="text-transform: uppercase;">
    <div id="errRuta" class="error"></div>

    <button class="btn" onclick="generarDias()">Generar días del mes</button>

    <div id="daysContainer"></div>
</div>

<script>
/* PLACAS PERMITIDAS */
const placasValidas = ["AAA111","BBB222","CCC333","EEE444"];

/* GENERAR DÍAS */
function generarDias() {
    let year = yearEl.value;
    let month = monthEl.value;
    let ruta = rutaEl.value.toUpperCase().trim();

    clearErrors();

    let error = false;

    if (!year) {
        errYear.innerHTML = "El año es obligatorio";
        error = true;
    }

    if (!month) {
        errMonth.innerHTML = "El mes es obligatorio";
        error = true;
    }

    // Validar formato ruta
    if (!/^[A-Z]-[A-Z0-9]+$/.test(ruta)) {
        errRuta.innerHTML = "Formato inválido. Ejemplo válido: U-001";
        error = true;
    }

    if (error) return;

    // Guardar ruta corregida en mayúsculas
    rutaEl.value = ruta;

    // Guardar campos base
    localStorage.setItem("year", year);
    localStorage.setItem("month", month);
    localStorage.setItem("ruta", ruta);

    renderDias(year, month);
}

function renderDias(year, month) {
    const monthNum = {
        "Enero":1,"Febrero":2,"Marzo":3,"Abril":4,"Mayo":5,"Junio":6,
        "Julio":7,"Agosto":8,"Septiembre":9,"Octubre":10,"Noviembre":11,"Diciembre":12
    }[month];

    const days = new Date(year, monthNum, 0).getDate();
    let html = "";

    for (let d = 1; d <= days; d++) {
        let fecha = `${d}/${monthNum}/${year}`;

        html += `
        <div class="row">
            <div><strong>${fecha}</strong></div>

            <div>
                <input class="placa" data-dia="${d}" data-campo="p1" placeholder="Placa Recorrido 1">
                <div class="error" id="err-p1-${d}"></div>
            </div>

            <div>
                <input class="placa" data-dia="${d}" data-campo="p2" placeholder="Placa Recorrido 2">
                <div class="error" id="err-p2-${d}"></div>
            </div>

            <div>
                <input class="obs" data-dia="${d}" data-campo="obs" placeholder="Observación">
            </div>
        </div>
        `;
    }

    daysContainer.innerHTML = html;

    activarValidaciones();
    restaurarDatos();
}

/* VALIDACIÓN PLACAS */
function activarValidaciones() {
    document.querySelectorAll(".placa").forEach(input => {
        input.addEventListener("input", function () {
            let dia = this.dataset.dia;
            let campo = this.dataset.campo;

            let limpio = this.value.toUpperCase()
                .replace(/\s/g,"")
                .replace(/-/g,"")
                .replace(/,/g,"");

            this.value = limpio;

            let errorBox = document.getElementById(`err-${campo}-${dia}`);

            if (!/^[A-Z]{3}[0-9]{3}$/.test(limpio)) {
                errorBox.innerHTML = "Formato inválido (AAA111)";
            }
            else if (!placasValidas.includes(limpio)) {
                errorBox.innerHTML = "REVISAR PLACA O CARGAR DOCUMENTOS EN EL DRIVE";
            }
            else {
                errorBox.innerHTML = "";
            }

            guardarFormulario();
        });
    });

    document.querySelectorAll(".obs").forEach(input => {
        input.addEventListener("input", guardarFormulario);
    });
}

/* GUARDAR FORMULARIO */
function guardarFormulario() {
    let datos = {};

    document.querySelectorAll(".placa, .obs").forEach(input => {
        let key = `${input.dataset.dia}-${input.dataset.campo}`;
        datos[key] = input.value;
    });

    localStorage.setItem("formData", JSON.stringify(datos));
}

/* RESTAURAR DATOS */
function restaurarDatos() {
    let datos = JSON.parse(localStorage.getItem("formData") || "{}");

    document.querySelectorAll(".placa, .obs").forEach(input => {
        let key = `${input.dataset.dia}-${input.dataset.campo}`;
        if (datos[key]) input.value = datos[key];
    });
}

/* LIMPIAR ERRORES */
function clearErrors() {
    errYear.innerHTML = "";
    errMonth.innerHTML = "";
    errRuta.innerHTML = "";
}

/* RESTAURAR CAMPOS PRINCIPALES */
window.onload = function () {
    if (localStorage.year) yearEl.value = localStorage.year;
    if (localStorage.month) monthEl.value = localStorage.month;
    if (localStorage.ruta) rutaEl.value = localStorage.ruta;
};

const yearEl = document.getElementById("year");
const monthEl = document.getElementById("month");
const rutaEl = document.getElementById("ruta");

const errYear = document.getElementById("errYear");
const errMonth = document.getElementById("errMonth");
const errRuta = document.getElementById("errRuta");
const daysContainer = document.getElementById("daysContainer");
</script>

</body>
</html>
