<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Recepción de Certificados</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        font-family: Arial, sans-serif;
        background: #eef1f7;
        margin: 0;
        padding: 0;
    }

    /* CONTENEDOR PRINCIPAL */
    .container {
        max-width: 95%;
        margin: 20px auto;
        background: #fff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.12);
    }

    h1 {
        text-align: center;
        color: white;
        background: #3155ff;
        padding: 18px;
        margin: 0 0 20px 0;
        border-radius: 0 0 10px 10px;
        font-size: 26px;
    }

    label {
        font-size: 18px;
        font-weight: bold;
        display: block;
        margin-top: 10px;
    }

    select, input {
        width: 100%;
        padding: 12px;
        margin-top: 5px;
        font-size: 18px;
        border-radius: 8px;
        border: 1px solid #ccc;
    }

    /* FILA DE FECHA + CAMPOS */
    .row {
        display: grid;
        grid-template-columns: 120px 1fr 1fr 1fr;
        gap: 10px;
        align-items: center;
        margin-bottom: 12px;
    }

    .row input {
        font-size: 18px;
    }

    .error {
        color: red;
        font-size: 14px;
        margin-top: -8px;
        margin-bottom: 5px;
    }

    .btn {
        margin-top: 15px;
        padding: 12px;
        background: #3155ff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 18px;
        width: 100%;
    }

    .btn:hover {
        background: #1e3fe0;
    }
</style>
</head>
<body>

<h1>Recepción de Certificados</h1>

<div class="container">

    <label>Año:</label>
    <select id="year">
        <option value="">Seleccione año</option>
        <option>2025</option>
        <option>2026</option>
        <option>2027</option>
    </select>
    <div id="errYear" class="error"></div>

    <label>Mes:</label>
    <select id="month">
        <option value="">Seleccione mes</option>
        <option>Enero</option><option>Febrero</option><option>Marzo</option>
        <option>Abril</option><option>Mayo</option><option>Junio</option>
        <option>Julio</option><option>Agosto</option><option>Septiembre</option>
        <option>Octubre</option><option>Noviembre</option><option>Diciembre</option>
    </select>
    <div id="errMonth" class="error"></div>

    <label>Número de Ruta:</label>
    <input id="ruta" placeholder="Ejemplo: U-001">
    <div id="errRuta" class="error"></div>

    <button class="btn" onclick="generarDias()">Generar días del mes</button>

    <div id="daysContainer"></div>
</div>

<script>
/* === LISTA DE PLACAS PERMITIDAS === */
const placasValidas = ["AAA111", "BBB222", "CCC333", "EEE444"];

/* ============================================================
   FUNCIÓN PARA GENERAR LOS DÍAS DEL MES
============================================================ */
function generarDias() {
    let year = document.getElementById("year").value;
    let month = document.getElementById("month").value;
    let ruta = document.getElementById("ruta").value.trim();

    let err = false;

    document.getElementById("errYear").innerHTML = "";
    document.getElementById("errMonth").innerHTML = "";
    document.getElementById("errRuta").innerHTML = "";

    if (!year) {
        document.getElementById("errYear").innerHTML = "El año es obligatorio";
        err = true;
    }
    if (!month) {
        document.getElementById("errMonth").innerHTML = "El mes es obligatorio";
        err = true;
    }

    // Validación de ruta: una letra, guion y luego cualquier cosa
    let rutaReg = /^[A-Za-z]-[A-Za-z0-9]+$/;
    if (!rutaReg.test(ruta)) {
        document.getElementById("errRuta").innerHTML = "Formato inválido. Ejemplo válido: U-001";
        err = true;
    }

    if (err) return;

    // Guardar selección en localStorage
    localStorage.setItem("year", year);
    localStorage.setItem("month", month);
    localStorage.setItem("ruta", ruta);

    let monthNumber = {
        "Enero":1,"Febrero":2,"Marzo":3,"Abril":4,"Mayo":5,"Junio":6,
        "Julio":7,"Agosto":8,"Septiembre":9,"Octubre":10,"Noviembre":11,"Diciembre":12
    }[month];

    let days = new Date(year, monthNumber, 0).getDate();
    let container = document.getElementById("daysContainer");
    container.innerHTML = "";

    for (let d = 1; d <= days; d++) {
        let dateStr = `${d}/${monthNumber}/${year}`;

        container.innerHTML += `
            <div class="row">
                <div><strong>${dateStr}</strong></div>

                <div>
                    <input class="placa" data-dia="${d}" placeholder="Placa Recorrido 1">
                    <div class="error" id="err1-${d}"></div>
                </div>

                <div>
                    <input class="placa" data-dia="${d}" placeholder="Placa Recorrido 2">
                    <div class="error" id="err2-${d}"></div>
                </div>

                <div>
                    <input class="obs" data-dia="${d}" placeholder="Observación">
                </div>
            </div>
        `;
    }

    activarValidaciones();
    restaurarDatos();
}


/* ============================================================
   VALIDACIÓN DE PLACAS + GUARDADO AUTOMÁTICO
============================================================ */
function activarValidaciones() {
    let placas = document.querySelectorAll(".placa");

    placas.forEach(input => {
        input.addEventListener("input", function() {
            let dia = this.dataset.dia;

            // Normalizar placa
            let p = this.value.toUpperCase()
                .replace(/\s/g, "")
                .replace(/-/g, "")
                .replace(/,/g, "");

            this.value = p;

            // Validación básica: 3 letras + 3 números
            let formato = /^[A-Z]{3}[0-9]{3}$/;

            let errorBox = document.getElementById(
                (this.parentNode.previousElementSibling ? "err2" : "err1") + "-" + dia
            );

            if (!formato.test(p)) {
                errorBox.innerHTML = "Formato inválido (AAA111)";
            } else if (!placasValidas.includes(p)) {
                errorBox.innerHTML = "REVISAR PLACA O CARGAR DOCUMENTOS EN EL DRIVE";
            } else {
                errorBox.innerHTML = "";
            }

            guardarFormulario();
        });
    });

    // Guardar observaciones
    document.querySelectorAll(".obs").forEach(input => {
        input.addEventListener("input", guardarFormulario);
    });
}


/* ============================================================
   GUARDAR TODO EN LOCALSTORAGE
============================================================ */
function guardarFormulario() {
    let datos = {};

    document.querySelectorAll(".placa").forEach(input => {
        datos[input.dataset.dia + "-p"] = input.value;
    });

    document.querySelectorAll(".obs").forEach(input => {
        datos[input.dataset.dia + "-o"] = input.value;
    });

    localStorage.setItem("formData", JSON.stringify(datos));
}


/* ============================================================
   RESTAURAR DATOS GUARDADOS
============================================================ */
function restaurarDatos() {
    let datos = JSON.parse(localStorage.getItem("formData") || "{}");

    document.querySelectorAll(".placa").forEach(input => {
        let key = input.dataset.dia + "-p";
        if (datos[key]) input.value = datos[key];
    });

    document.querySelectorAll(".obs").forEach(input => {
        let key = input.dataset.dia + "-o";
        if (datos[key]) input.value = datos[key];
    });
}


/* ============================================================
   RESTAURAR CAMPOS PRINCIPALES EN EL INICIO
============================================================ */
window.onload = function() {
    let y = localStorage.getItem("year");
    let m = localStorage.getItem("month");
    let r = localStorage.getItem("ruta");

    if (y) document.getElementById("year").value = y;
    if (m) document.getElementById("month").value = m;
    if (r) document.getElementById("ruta").value = r;
};
</script>

</body>
</html>
